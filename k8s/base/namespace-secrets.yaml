# Kubernetes Namespace for VMShift
apiVersion: v1
kind: Namespace
metadata:
  name: vmshift
  labels:
    app: vmshift
---
# Secrets (Create actual secrets separately - this is a template)
# kubectl create secret generic vmshift-secrets \
#   --from-literal=database-url='postgresql://user:pass@host:5432/db' \
#   --from-literal=redis-url='redis://redis:6379/0' \
#   --from-literal=celery-broker-url='redis://redis:6379/0' \
#   --from-literal=celery-result-backend='redis://redis:6379/1' \
#   -n vmshift
apiVersion: v1
kind: Secret
metadata:
  name: vmshift-secrets
  namespace: vmshift
type: Opaque
stringData:
  # Replace these with your actual values
  database-url: "postgresql://vmshift_user:CHANGE_ME@your-db.db.akamai.com:5432/vmshift"
  redis-url: "redis://redis:6379/0"
  celery-broker-url: "redis://redis:6379/0"
  celery-result-backend: "redis://redis:6379/1"
---
# Resource Quota for the namespace
apiVersion: v1
kind: ResourceQuota
metadata:
  name: vmshift-quota
  namespace: vmshift
spec:
  hard:
    requests.cpu: "4"
    requests.memory: "4Gi"
    limits.cpu: "8"
    limits.memory: "8Gi"
    pods: "20"
---
# Network Policy - Allow internal communication
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: vmshift-network-policy
  namespace: vmshift
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: vmshift
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: vmshift
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 5432  # PostgreSQL
